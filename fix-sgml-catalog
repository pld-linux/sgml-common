#!/bin/sh
    
# very simple script that makes CATALOG file

sgmldir=/usr/share/sgml
catalogs_dir="catalogs"
catalog=$sgmldir/CATALOG
catalog_ext="cat"

# script lists *.cat files added to catalogs_dir by rpm packages
# CATALOG file
# if *.cat file is regular file, there is "CATALOG $catalogs_dir/file.cat"
# line added
# if cat file is a symlink then it is resolved and resolved filename is added

[ ! -f "${catalog}" ] || mv -f ${catalog} ${catalog}.bak
echo "-- This file is autogenerated by $0 script --" >${catalog}

cd ${sgmldir}
if [ $? -eq 0 ]; then
    for plik in ${catalogs_dir}/*.${catalog_ext}; do 
	##echo "Adding file $plik to CATALOG" >/dev/stderr
	if [ -r "$plik" ]; then
	    if [ -L $plik ]; then
		# find linkend
		plik=`ls -l $plik | awk '{print $NF}'`
		# if it is relative linkend remove "../"
		plik=`echo $plik | sed 's#^\.\./##'`
	    fi
	    echo "CATALOG \"$plik\"" >>${catalog}
	fi
    done
else
    mv -f ${catalog}.bak ${catalog}
fi

chmod 644 ${catalog}
